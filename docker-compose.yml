version: '3.9'
services:
  detectron-vlp-api:
    build:
      context: ./detectron_vlp_api
    # image: khiemledev/detectron_vlp_api
    volumes:
      - ./detectron_vlp_api:/workingspace
    networks:
      - vlp_service
    deploy:
      update_config:
        parallelism: 2
        delay: 10s
      restart_policy:
        condition: on-failure
      resources:
        reservations:
          devices:
            - driver: nvidia
              device_ids: ['1']
              capabilities: [gpu]

  vlp-ic-api:
    build: .
    ports:
      - "8082:80"
    volumes:
      - ./app:/usr/src/app
      - /mlcv:/mlcv
    networks:
      - vlp_service
    deploy:
      update_config:
        parallelism: 2
        delay: 10s
      restart_policy:
        condition: on-failure
      resources:
        reservations:
          devices:
            - driver: nvidia
              device_ids: ['1']
              capabilities: [gpu]

networks:
  vlp_service: